# NDT报告生成器系统需求文档

## 1. 项目概述

### 1.1 项目背景
NDT（Non-Destructive Testing，无损检测）报告生成器是一个专业的工业检测报告自动化生成系统，主要用于石油化工、管道工程等领域的射线检测、表面检测等无损检测报告的批量生成。

### 1.2 项目目标
- 实现Excel数据到Word报告的自动化转换
- 支持多种检测类型的报告生成
- 提供友好的图形用户界面
- 确保报告格式的标准化和一致性
- 提高检测报告生成效率，减少人工错误

### 1.3 技术架构
- **开发语言**: Python 3.x
- **核心依赖**: pandas, python-docx, openpyxl, tkinter
- **架构模式**: 模块化设计，GUI与业务逻辑分离
- **数据流**: Excel → 数据处理 → Word模板填充 → 报告生成

## 2. 功能模块详细需求

### 2.1 射线检测委托台账模块 (Ray_Detection.py)

#### 2.1.1 功能描述
将Excel委托台账数据自动填入射线检测委托台账Word模板，支持按委托单编号分组生成多份报告。

#### 2.1.2 输入数据源
- **Excel文件**: `生成器/Excel/1_生成器委托.xlsx`
- **Word模板**: `生成器/wod/1_射线检测委托台账_Mode2.docx`

#### 2.1.3 数据映射规则

| Excel列 | 列名 | Word文档目标位置 | 处理规则 |
|---------|------|------------------|----------|
| A列 | 委托日期 | 委托人、监理单位、建设单位日期处 | 取最晚日期 |
| C列 | 委托单编号 | 委托单编号值 | 按此列分组生成报告 |
| D列 | 检件编号 | 管道编号表格列 | 逐行填入 |
| E列 | 焊口编号 | 焊口号表格列 | 逐行填入 |
| F列 | 焊工号 | 焊工号表格列 | 逐行填入 |
| G列 | 规格 | 焊口规格表格列 | 逐行填入 |
| H列 | 材质 | 焊口材质表格列 | 逐行填入 |
| I列 | 合格级别 | 合格级别值 | 同组取一个值 |
| J列 | 检测比例 | 检测比例值 | 同组取一个值 |
| O列 | 备注 | 备注表格列 | 逐行填入 |
| Q列 | 单元名称 | 单元名称值 | 同组取一个值 |
| R列 | 焊接方法 | 焊接方法值 | 同组取一个值 |
| S列 | 区号 | 区号值 | 同组取一个值 |
| T列 | 单线号 | 单线号表格列 | 逐行填入 |
| V列 | 检测时机 | 检测时机值 | 同组取一个值 |

#### 2.1.4 参数配置
系统需要支持以下5个可配置参数：
- **工程名称**: 替换文档中的"工程名称值"
- **检测类别号**: 替换文档中的"检测类别号值"
- **检测标准**: 替换文档中的"检测标准值"
- **检测方法**: 替换文档中的"检测方法值"
- **坡口形式**: 替换文档中的"坡口形式值"

#### 2.1.5 输出规范
- **输出路径**: `生成器/输出报告/1_射线检测委托台账_Mode2/`
- **文件命名**: `委托单编号_射线检测委托台账.docx`

### 2.2 RT结果通知单台账模块 (NDT_result.py)

#### 2.2.1 功能描述
处理射线检测结果数据，生成RT结果通知单台账，支持Mode1和Mode2两种模式。

#### 2.2.2 Mode2模式数据映射

| Excel列 | 列名 | Word文档目标位置 | 处理规则 |
|---------|------|------------------|----------|
| B列 | 完成日期 | 检测人、审核日期处 | 取最晚日期 |
| C列 | 委托单编号 | 委托单编号表格列、通知单编号 | 按此列分组 |
| D列 | 检件编号 | 单线号表格列 | 逐行填入 |
| E列 | 焊口编号 | 焊口号表格列 | 逐行填入 |
| F列 | 焊工号 | 焊工号表格列 | 逐行填入 |
| K列 | 返修补片 | 检测结果表格列 | 逐行填入 |
| O列 | 备注 | 备注表格列 | 逐行填入 |
| Q列 | 单元名称 | 单位工程名称处 | 取第一个值 |
| W列 | 实际不合格 | 返修张/处数表格列 | 空值填"0" |

#### 2.2.3 参数配置
- **工程名称**: 替换"工程名称参数值"
- **委托单位**: 替换"委托单位参数值"
- **检测方法**: 替换"检测方法参数"

### 2.3 表面结果通知单台账模块 (Surface_Defect.py)

#### 2.3.1 功能描述
处理表面检测结果数据，生成表面结果通知单台账。

#### 2.3.2 数据映射规则
与RT结果通知单台账基本相同，主要差异在于：
- **输入文件**: `生成器/Excel/3_生成器表面结果.xlsx`
- **模板文件**: `生成器/wod/3_表面结果通知单台账_Mode2.docx`
- **委托单号值**: 需要替换文档中的"委托单号值"

### 2.4 射线检测记录模块 (Radio_test.py)

#### 2.4.1 功能描述
生成详细的射线检测记录，支持X射线和γ射线两种检测方式，根据射线类型自动匹配相应的技术参数。

#### 2.4.2 分组规则
按以下两个维度进行分组：
- **委托单编号** (C列)
- **γ射线类型** (P列，空值表示X射线)

#### 2.4.3 射线类型相关参数

**X射线参数设置**:
- 焦点尺寸值: 2.5×2.5
- 铅增感屏值: 0.03×2
- 胶片等级值: 锐科R400

**γ射线参数设置**:
- 焦点尺寸值: 3×3
- 铅增感屏值: 柯达0.1×2
- 胶片等级值: 柯达MX125

#### 2.4.4 技术参数匹配
系统需要根据检件规格自动匹配技术参数：

**X射线参数匹配** (使用`4_生成器X射线指导书模版.xlsx`):
- 透照方式 → Word文档"透照方式"列
- 焦距 → Word文档"焦距"列
- 源强 → Word文档"管电压源能量"列
- 源活 → Word文档"管电流源活度"列
- 曝光时间 → Word文档"曝光时间"列
- 一次透照长度 → Word文档"有效片长"列

**γ射线参数匹配** (使用`4_生成器γ射线指导书模版.xlsx`):
- 透照方式 → Word文档"透照方式"列
- 焦距 → Word文档"焦距"列
- 源强 → Word文档"管电流源活度"列
- 一次透照长度 → Word文档"有效片长"列

#### 2.4.5 参数配置
- **工程名称**: 替换"工程名称值"
- **委托单位**: 替换"委托单位值"
- **操作指导书编号**: 替换"操作指导书编号值"
- **承包单位**: 替换"承包单位值"
- **设备型号**: 替换"设备型号值"

### 2.5 射线检测记录续表模块 (Radio_test_renewal.py)

#### 2.5.1 功能描述
生成射线检测记录的续表，主要处理片号信息和像质计灵敏度数据。

#### 2.5.2 片号填写规则
根据M列"张数"值确定片号填写方式：
- **张数=1,4,5**: 片号列不填
- **张数=2**: 依次填写"1,2"
- **张数=3**: 依次填写"1,2,3"
- **张数≥6**: 依次填写"1-2,2-3,3-4,4-5,5-6,N-1"

#### 2.5.3 参数配置
- **工程名称**: 替换"工程名称值"
- **委托单位**: 替换"委托单位值"
- **操作指导书编号**: 替换"操作指导书编号值"

## 3. 图形用户界面需求

### 3.1 界面布局
- **左侧导航栏**: 显示5个功能模块按钮
- **右侧内容区**: 显示当前选中模块的操作界面
- **底部状态栏**: 显示当前处理状态

### 3.2 操作流程
1. 选择功能模块
2. 配置文件路径（Excel输入、Word模板、输出目录）
3. 设置业务参数
4. 执行处理并查看日志
5. 查看处理结果

### 3.3 用户体验要求
- 支持中文界面
- 提供实时处理日志
- 支持文件路径浏览选择
- 异常情况友好提示
- 处理进度可视化

## 4. 技术实现要求

### 4.1 数据处理
- 使用pandas进行Excel数据读取和处理
- 支持大批量数据处理
- 数据验证和异常处理
- 日期格式自动识别和转换

### 4.2 文档生成
- 使用python-docx进行Word文档操作
- 保持原有文档格式和样式
- 支持表格动态行数调整
- 文档模板兼容性保证

### 4.3 错误处理
- 文件不存在检查
- 数据格式验证
- 异常情况日志记录
- 用户友好的错误提示

### 4.4 性能要求
- 支持处理千级别数据记录
- 内存使用优化
- 多线程处理支持
- 响应时间控制在合理范围

## 5. 部署和维护

### 5.1 环境要求
- Python 3.7+
- Windows操作系统
- 必要的Python包依赖

### 5.2 安装部署
- 提供requirements.txt依赖清单
- 支持pip安装方式
- 提供使用说明文档

### 5.3 维护支持
- 模块化设计便于维护
- 详细的代码注释
- 日志记录便于问题排查
- 版本控制和更新机制

## 6. 数据流程和业务逻辑

### 6.1 数据处理流程

```text
Excel数据读取 → 数据验证 → 按业务规则分组 → 模板加载 → 数据填充 → 文档保存 → 结果反馈
```

### 6.2 关键业务规则

#### 6.2.1 委托单编号分组规则

- 所有模块都需要按C列"委托单编号"进行数据分组
- 每个唯一的委托单编号生成一份独立的Word文档
- 射线检测记录模块还需要额外按P列"γ射线"类型分组

#### 6.2.2 日期处理规则

- 委托日期/完成日期需要取同组数据中的最晚日期
- 日期格式自动识别和转换（支持多种Excel日期格式）
- Word文档中的日期按"YYYY年MM月DD日"格式填入

#### 6.2.3 空值处理规则

- Excel中的空值在Word中对应位置保持为空
- "实际不合格"列的空值特殊处理为"0"
- 备注列的空值保持为空字符串

#### 6.2.4 文本替换规则

- 精确匹配特定的占位符文本进行替换
- 支持段落级别和表格单元格级别的文本替换
- 保持原有文档的格式和样式

### 6.3 文件命名规范

- 射线检测委托台账: `{委托单编号}_射线检测委托台账.docx`
- RT结果通知单: `{委托单编号}_RT结果通知单.docx`
- 表面结果通知单: `{委托单编号}_表面结果通知单.docx`
- 射线检测记录: `EPKJ-{委托单编号}_{射线类型}_射线检测记录.docx`
- 射线检测记录续: `EPKJ-{委托单编号}_{射线类型}_射线检测记录续.docx`

## 7. 质量保证和测试要求

### 7.1 功能测试

- 各模块独立功能测试
- 数据映射准确性测试
- 边界条件测试（空数据、大数据量等）
- 异常情况处理测试

### 7.2 集成测试

- GUI与后端模块集成测试
- 多模块协同工作测试
- 文件IO操作测试
- 用户操作流程测试

### 7.3 性能测试

- 大数据量处理性能测试
- 内存使用情况监控
- 响应时间测试
- 并发处理能力测试

### 7.4 兼容性测试

- 不同版本Excel文件兼容性
- 不同版本Word模板兼容性
- 不同操作系统环境测试
- Python版本兼容性测试

## 8. 风险评估和应对策略

### 8.1 技术风险

- **文档格式兼容性风险**: 建立标准模板规范，定期测试兼容性
- **数据处理性能风险**: 优化算法，实现分批处理机制
- **第三方库依赖风险**: 锁定稳定版本，建立备选方案

### 8.2 业务风险

- **数据准确性风险**: 建立数据验证机制，增加人工审核环节
- **用户操作风险**: 提供详细操作指南，增加操作确认机制
- **需求变更风险**: 采用模块化设计，提高系统可扩展性

### 8.3 运维风险

- **环境依赖风险**: 提供完整的环境配置文档
- **数据备份风险**: 建立自动备份机制
- **版本管理风险**: 建立规范的版本发布流程

## 9. 扩展性和未来规划

### 9.1 功能扩展

- 支持更多检测类型的报告生成
- 增加报告模板自定义功能
- 支持批量处理多个Excel文件
- 增加数据统计和分析功能

### 9.2 技术升级

- 考虑Web化部署方案
- 数据库存储支持
- 云端处理能力
- API接口开放

### 9.3 用户体验优化

- 增加拖拽式操作界面
- 提供报告预览功能
- 支持自定义输出格式
- 增加操作历史记录

## 10. 项目交付物

### 10.1 软件交付物

- 完整的Python源代码
- 可执行程序包
- 依赖库清单(requirements.txt)
- 配置文件和模板文件

### 10.2 文档交付物

- 详细设计文档
- 用户操作手册
- 系统部署指南
- API接口文档（如适用）

### 10.3 测试交付物

- 测试用例文档
- 测试数据集
- 测试报告
- 性能测试报告

### 10.4 培训交付物

- 用户培训材料
- 操作视频教程
- 常见问题解答(FAQ)
- 技术支持联系方式

---

**文档版本**: v1.0
**编写日期**: 2025-06-20
**最后更新**: 2025-06-20
**文档状态**: 初稿完成
